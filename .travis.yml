language: groovy
os: linux
dist: bionic
arch: amd64 
sudo: required
services: docker

on: [push, pull_request]

install:
    - echo "Installing Nextflow"
    - wget -qO- https://get.nextflow.io | bash
    - sudo mv nextflow /usr/local/bin
    
    
before_script:
    - echo "Build docker image"
    - sudo docker build . --file ./Dockerfile --tag variantcalling
    
    #- name: Pull Docker Image
    #  run : | 
    #    echo "Pull Docker Image"
    #    docker pull daviesdrew/pipelines:variantcalling
    #    docker tag daviesdrew/pipelines:variantcalling daviesdrew/pipelines:variantcalling
scripts:                
    - echo ${GITHUB_WORKSPACE}
    - nextflow run main.nf -profile test -with-docker variantcalling:latest --fastp_min_base_quality 15 --fastp_max_percent_low_qual_base 40 

after_success:
    - echo "CI build of variantcalling pipeline succeeded"

after_failure: 
    - echo "CI build of variantcalling pipeline failed"


